import{j as e,r as n,u as f,s as o,B as j}from"./index-sTzWSQTh.js";import{U as N,a as v}from"./useMyContext-JxEDvxIB.js";import"https://cdn.socket.io/4.4.1/socket.io.esm.min.js";import"./MyContext-Y8Dh-zwD.js";function w({avatar:t,text:r,author:a}){return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsx("img",{src:`/resources/characters/${t}.png`,className:"h-10 w-10"}),e.jsx("p",{className:"text-xs",children:a})]}),e.jsx("p",{className:"border-2 rounded-lg p-2 sm:text-lg text-xs",children:r})]})}let p=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((r,a)=>(a&=63,a<36?r+=a.toString(36):a<62?r+=(a-26).toString(36).toUpperCase():a>62?r+="-":r+="_",r),"");function E(){const{userData:t,resetUserData:r,totalMembers:a,setTotalMembers:m}=N(),[l,x]=n.useState(""),c=f(),[d,u]=n.useState([]);n.useEffect(()=>(o.on("room-size",s=>{m(s)}),()=>{o.off("room-size")}),[a,m]),n.useEffect(()=>(o.on("chat-broadcast",s=>{u(i=>[...i,{id:p(),text:s.message,avatar:s.userData.character,author:s.userData.userName}])}),()=>{o.off("chat-broadcast")}),[d]),n.useEffect(()=>{t.roomCode===""&&(j("Disconnected,Join Again.",{type:"error"}),c("/join"))},[t.roomCode,c]);const g=s=>{s.preventDefault(),u(i=>[...i,{id:p(),text:l,avatar:t.character,author:t.userName}]),o.emit("new-chat",{userData:t,message:l}),x("")},h=()=>{o.emit("custom-room",t.roomCode,"leave-room",s=>{console.log(`exited ${s}`)}),o.disconnect(),r(),c("/")};return e.jsx("div",{className:"h-screen bg-black py-2 sm:px-0 px-2 overflow-hidden",children:e.jsxs("div",{className:"sm:w-2/3  bg-neutral-light dark:bg-gray-800 h-full grid grid-cols-2 grid-rows-12 mx-auto rounded-lg",children:[e.jsx("div",{className:"col-span-2 row-span-1",children:e.jsxs("div",{className:"flex justify-between dark:bg-primary-dark items-center sm:px-10 px-4 py-2 bg-neutral-light-gray rounded-lg",children:[e.jsxs("p",{className:"font-inter text-primary-medium-green sm:text-lg text-xs dark:text-primary-light",children:["Connected to room:",e.jsx("span",{className:" dark:text-primary-light",children:t.roomCode})]}),e.jsxs("p",{className:"text-accent-light font-inter dark:text-white font-semibold sm:text-lg text-xs",children:["Connected:",a]}),e.jsxs("div",{className:"flex flex-col items-center cursor-pointer",onClick:h,children:[e.jsx("img",{src:"/resources/Exit.png",className:"sm:w-auto sm:h-auto h-5 w-5"}),e.jsx("p",{className:"font-joti text-xs",children:"Exit"})]})]})}),e.jsx("div",{className:"col-span-2 row-span-10 w-full h-full sm:px-10 px-2 sm:py-4 py-2 overflow-y-scroll flex flex-col gap-4",children:d.map(s=>e.jsx(w,{text:s.text,avatar:s.avatar,author:s.author},s.id))}),e.jsxs("form",{className:"col-span-2 row-span-1 dark:bg-primary-dark bg-neutral-dark-gray  flex items-center px-2 gap-2",onSubmit:s=>g(s),children:[e.jsx("input",{placeholder:"Enter Message",type:"text",className:"w-full p-2 rounded-lg outline-none dark:text-black",value:l,onChange:s=>x(s.target.value)}),e.jsx("button",{type:"submit",className:"h-10 w-10 rounded-full bg-primary-medium flex justify-center items-center",children:e.jsx(v,{})})]})]})})}export{E as default};
